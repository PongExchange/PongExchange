"use strict";

var Sql = require('Sql'); 

var Player = module.exports;

/*
	returns the player with parameter 'id' or null if not found
 */
Player.get = function*(id)
{
	var result = null;
	if (typeof id != 'number' || id <= 0) return result;
	
	yield Sql.using(function*(db)
	{
		var dbResult = yield db.query('select * from players where id = $1', [id]);
		if (dbResult.rowCount === 1)
		{
			result = dbResult.rows[0];
		}
	});
	
	return result; 
};

/*
	returns the id of the newly-inserted parameter 'player'; returns 0 if the insert failed
 */
Player.insert = function*(player)
{
	var result = 0;
	if (!player || !player.name) return result;
	
	yield Sql.using(function* (db) 
	{
		var dbResult = yield db.query(
			'insert into players (name, email, rating) values ($1, $2, $3) returning id;',
			[player.name, player.email, player.rating || 0]);
		
		if (dbResult.rowCount === 1)
		{
			result = dbResult.rows[0].id;
		}
	});
	
	return result;
};

