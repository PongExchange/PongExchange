"use strict";
/* -------------------------------------------------------------------
 * Require Statements << Keep in alphabetical order >>
 * ---------------------------------------------------------------- */

var Config = require('Config');

/* =============================================================================
 * 
 * Middleware - Custom middleware for just our app.
 *  
 * ========================================================================== */

var Middleware = module.exports;

/* -------------------------------------------------------------------
 * Static Methods << Keep in alphabetical order >>
 * ---------------------------------------------------------------- */

Middleware.jadeContextVariables = function * (next)
{
	this._render = this.render;
	this.render = render;
	yield next;
};

/* -------------------------------------------------------------------
 * Private Methods << Keep in alphabetical order >>
 * ---------------------------------------------------------------- */

function * render (template, locals, force)
{
	// jshint validthis: true
	if (!locals)
		locals = {};
	
	locals.tier = Config.tier;
	locals.isLocal = Config.tier === 'local';
	locals.isProduction = Config.tier === 'production';

	if (!locals.player)
		locals.player = this.player;
	
	if (!this.player)
	{
		locals.login = {
			clientId: Config.google.clientId,
			scopes: Config.google.scopes.join(' ')
		};
	}

	yield this._render(template, locals, force);
}
